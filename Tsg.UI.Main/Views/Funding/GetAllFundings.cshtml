@using System.Globalization
@using Tsg.Business.Model.TsgGPWebService
@using Tsg.UI.Main.App_LocalResources
@using Tsg.UI.Main.Models
@using TSG.Models.Enums
@using WinstantPay.Common.Extension
@model List<TSG.Models.ServiceModels.Fundings>

    @{
        ViewBag.Title = GlobalRes.Shared_Navigation_AddFunds;
        Layout = "~/Views/Shared/_LayoutMain.cshtml";
    }
    <script type="text/javascript" src="/Content/assets/vendor/jquery/jquery.js"></script>

    <div class="row">
        <section class="panel">

            <header class="panel-heading">
                <h2 class="panel-title">@ViewBag.Title</h2>
                <p class="panel-subtitle">@GlobalRes.FundingGetBankDepositsPage_SubTitle</p>
            </header>

            <div class="panel-body" style="display: block;">
                @if (Model != null)
                {
                    string[] crypto = { "BTC", "ETH", "XAU" };

                    <table class="table table-bordered table-striped table-condensed mb-none" id="datatable-default">

                        <thead>
                            <tr>
                                <th>@GlobalRes.FundingGetBankDepositsPage_Id</th>
                                <th>@GlobalRes.FundingGetBankDepositsPage_Status</th>
                                <th>@GlobalRes.FundingGetBankDepositsPage_Source</th>
                                @*<th>@GlobalRes.FundingGetBankDepositsPage_CCyAndBank</th>*@
                                <th>@GlobalRes.FundingGetBankDepositsPage_Amount</th>
                                <th>@GlobalRes.FundingGetBankDepositsPage_CreatedDate</th>
                                <th class="hidden">@GlobalRes.FundingGetBankDepositsPage_ProofOfPayment</th>
                                <th>@GlobalRes.GetBanksPage_Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                int i = 0;
                                foreach (var item in Model)
                                {
                                    i = i + 1;
                                    var amount = item.Fundings_Amount;
                                    <tr>
                                        <td class="text-center">
                                            @i
                                        </td>
                                        <td style="padding-left: 20px">
                                            @{
                                                var description = EnumHelper<FundingStatus>.GetDisplayValue((FundingStatus)item.Fundings_StatusByFund);
                                            }
                                            @if (item.Fundings_StatusByFund == (int)FundingStatus.InProcess)
                                            {
                                                <span class="label btn-xs btn-default_custom">@description</span>
                                            }
                                            @if (item.Fundings_StatusByFund == (int)FundingStatus.Pending)
                                            {
                                                <span class="label btn-xs btn-warning_custom">@description</span>
                                            }
                                            @if (item.Fundings_StatusByFund == (int)FundingStatus.Credited)
                                            {
                                                <span class="label btn-xs btn-success_custom">@description</span>
                                            }
                                            @if (item.Fundings_StatusByFund == (int)FundingStatus.Canceled)
                                            {
                                                <span class="label btn-xs btn-danger_custom">@description</span>
                                            }
                                        </td>
                                        <td style="padding-left: 20px">
                                            <span>
                                                @*<img src="/Content/assets/images/onebyone.png" class="flag flag-@(item.Fundings_FundingSource.FundingSources_DesignName.ToLower())" />*@
                                                @item.Fundings_FundingSource.FundingSources_SourceName
                                            </span>
                                        </td>
                                        <td class="text-right" style="padding-right: 20px">
                                            <span>@(crypto.Contains(item.Fundings_Currency.Currency_CcyCode) ? amount.ToString("N8", new CultureInfo("en-US")) : amount.ToString("N2", new CultureInfo("en-US")))</span>
                                            <span style="padding-left: 5px">
                                                @String.Format("{0}", item.Fundings_Currency.Currency_CcyCode)
                                                <img src="/Content/assets/images/onebyone.png" class="flag flag-@(item.Fundings_Currency.Currency_CcyCode.ToLower())" />
                                            </span>
                                        </td>
                                        <td style="padding-left: 20px">
                                            @String.Format("{0:MMM dd, yyyy}", item.Fundings_CreateDate) at @String.Format("{0:HH:mm}", item.Fundings_CreateDate)
                                        </td>

                                        <td style="padding-left: 20px">
                                            @if (!item.Fundings_IsDeleted) {
                                                
                                                <a class = "@(item.Fundings_FundingSource.FundingSources_DesignName != "WinstantPay"? "fa fa-eye":"fas fa-pencil-alt")" href="@Url.Action("InfoByFunds", "Funding", new {fundId = item.Fundings_Id, sourceId = item.Fundings_SourceType})"></a>
                                                @*<span>|</span>
                                                <a class = "fas fa-trash-alt" onclick = "ondeleteDep('@item.Fundings_Id')" data-toggle = "modal" data-target = "#deleteModal" aria-hidden = "true" style = "text-decoration: none; font-size: 18px" ></a>*@
                                            }
                                        </td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                    <!-- Modal Delete Begin -->
                    @*<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="createModalLabel" aria-hidden="true">
                        @Html.Hidden("jsDepositId", new { id = "jsDepositId" })

                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <img src="/Content/assets/images/winstantpay-logo-notag.png" height="35" alt="" />
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="margin-top: 5px">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <br />
                                    <div class="row">
                                        <div class="col-sm-12">@GlobalRes.FundingGetBankDepositsPage_DeleteRecMessage</div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-success" onclick="deleteDeposit();">@GlobalRes.GetBankDepositPage_Yes</button>
                                    <button type="button" class="btn btn-danger" data-dismiss="modal">@GlobalRes.GetBankDepositPage_No</button>
                                </div>
                            </div>
                        </div>
                    </div>*@
                }

                <div style="padding-top: 5px">
                    <a class="btn btn-success" href="@Url.Action("AddFundsWire")">@GlobalRes.FundingGetBankDepositsPage_UploadProof</a>
                </div>

            </div>

        </section>
    </div>

    <script type="text/javascript">
    function ondeleteDep(depId) {
        $("#jsDepositId").val(depId);
        console.log(depId);

    }

    function deleteDeposit() {
        var depositId = $("#jsDepositId").val();
        console.log(depositId);
        $.post("@Url.Action("DeleteBankDeposit", "Funding")?depositId=" + depositId);
        $('#deleteModal').modal('toggle');
        location.reload();
    }

    $(".printlink").click(function() {
        var bankCcyId = $(this).attr('name');

        var myWindow = window.open("@Url.Action("GetPrintFriendlyInstruction", "WireInstruction")?val=" + bankCcyId, "_blank",
            "menubar=no, toolbar=no, resizable=no, top=100, left=200, width=500, height=500");
    });
    </script>

    @section customcss {
        <!-- Specific Page Vendor CSS -->
        <link rel="stylesheet" href="/Content/assets/vendor/select2/css/select2.css" />
        <link rel="stylesheet" href="/Content/assets/vendor/select2-bootstrap-theme/select2-bootstrap.css" />
        <link rel="stylesheet" href="/Content/assets/vendor/jquery-datatables-bs3/assets/css/datatables.css" />
    }

    @section VendorScripts {

        <script src="/Content/assets/vendor/select2/js/select2.js"></script>
        <script src="/Content/assets/vendor/jquery-datatables/media/js/jquery.dataTables.js"></script>
        <script src="/Content/assets/vendor/jquery-datatables/extras/TableTools/js/dataTables.tableTools.min.js"></script>
        <script src="/Content/assets/vendor/jquery-datatables-bs3/assets/js/datatables.js"></script>
    }

    @section Scripts {

        <!-- Examples -->
        <script src="/Content/assets/javascripts/tables/examples.datatables.default.js"></script>
    }
