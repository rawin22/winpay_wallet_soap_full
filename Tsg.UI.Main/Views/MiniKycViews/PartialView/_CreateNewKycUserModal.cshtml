@using Tsg.UI.Main.App_LocalResources
@model TSG.Models.APIModels.KycIntegrationModel.MiniKycAddNewUser
<script src="/Scripts/jquery.unobtrusive-ajax.min.js" type="text/javascript"></script>

<div class="modal fade" id="addNewKycUserModalWindow" tabindex="-1" role="dialog" aria-labelledby="addNewKycModalWindow-label" aria-hidden="true">
    <div class="modal-dialog" role="document">
        
        <script>

            function success_query_AddMiniKycUser(data) {
                console.log(data);

                setTimeout(function() {
                    $("#addNewKycUserModalWindow").modal('toggle');
                    //set data
                    $("#toIdtB").val(data.Obj.Item1);
                    $("#IsKycCreated").val(true);
                    $("#KycId").val(data.Obj.Item2);
                    $("#KycUserName").val(data.Obj.Item3);
                    // Clear pop-up box
                    $("#EmailAddress").val("");
                    $("#FirstName").val("");
                    $("#LastName").val("");

                    $("#infoByExistUser").text("");
                    $("#infoByExistUser").addClass("hidden");
                    $("#btnCreateNewKycUser").addClass("hidden");
                }, 500);
                if (data.Success) {
                    swal({
                        title: data.InfoBlock.UserMessage,
                        timer: 2000,
                        type: 'success',
                        showConfirmButton: false
                    });
                } else {
                    swal({
                        title: data.InfoBlock.UserMessage,
                        timer: 2000,
                        type: 'warning',
                        showConfirmButton: false
                    });
                }
                $.unblockUI();
            }

            function begin_query_AddMiniKycUser() {
                $.blockUI({
                    message:
                        '<div class="loader-wrapper"><div class="loader-container"><div class="line-scale"><div></div><div></div><div></div><div></div><div></div></div></div></div>',
                    overlayCSS: {
                        backgroundColor: '#FFF',
                        opacity: 0.8,
                        cursor: 'wait'
                    },
                    css: {
                        border: 0,
                        padding: 0,
                        backgroundColor: 'transparent'
                    }
                });
                //$("#form_AddNewKycUser").submit();
            }

            function failure_query_AddMiniKycUser(data) {
                $.unblockUI();
                try {
                    printErrorMessage("Unspecified error");

                    setTimeout(function() {
                        closeErrorMessage();
                    }, 2000);
                }
                catch (e) {}
            }
        </script>

        @{
            AjaxOptions options = new AjaxOptions();
            options.HttpMethod = "POST";
            options.OnSuccess = "success_query_AddMiniKycUser";
            options.OnBegin = "begin_query_AddMiniKycUser";
            options.OnFailure = "failure_query_AddMiniKycUser";
        }
        

        @using (Ajax.BeginForm(actionName:"Post", controllerName: "MiniKycRegistration", routeValues:"", ajaxOptions:options,  htmlAttributes:new { id = "form_AddNewKycUser" }))
        {
            <div class="modal-content">
                <div class="modal-header">
                    <img src="/Content/assets/images/winstantpay-logo-notag.png" height="35" alt="" />
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="margin-top: 5px">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>@GlobalRes.ContactUsIndexPage_Email</label>
                        @Html.TextBox("EmailAddress", String.Empty, new { @class = "form-control", id = "EmailAddress" })
                        @Html.ValidationMessage("EmailAddress", new { })
                    </div>
                    <div class="form-group">
                        <label>@GlobalRes.User_ProfilePage_FirstName</label>
                        @Html.TextBox("FirstName", String.Empty, new { @class = "form-control", id = "FirstName" })
                        @Html.ValidationMessage("FirstName", new { })
                    </div>
                    <div class="form-group">
                        <label>@GlobalRes.User_ProfilePage_LastName</label>
                        @Html.TextBox("LastName", String.Empty, new { @class = "form-control", id = "LastName" })
                        @Html.ValidationMessage("LastName", new { })
                    </div>
                </div>
                <div class="modal-footer">
                    @Html.ValidationMessage("totalValidation", new { @id = "totalValidation", @class = "alert alert-danger hidden" })
                    <input type="submit" class="btn btn-success" title="@GlobalRes.EditBankPage_Save" />
                </div>
            </div>
        }
    </div>
</div>