@using Tsg.UI.Main.App_LocalResources
@model Tsg.UI.Main.Models.ExchangeModel

<style>
    .currenySelector {
        padding-bottom: 10px;
        padding-left: 7px;
    }

    .currenyAmount {
        padding-right: 9px;
    }

    .labelAmount {
        padding-right: 21px;
    }

    @@media only screen and (max-width: 768px) {
        .currenySelector {
            padding-bottom: 10px;
            padding-left: 15px;
        }

        .currenyAmount {
            padding-right: 15px;
        }
    }

    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        /* display: none; <- Crashes Chrome on hover */
        -webkit-appearance: none;
        margin: 0; /* <-- Apparently some margin are still there even though it's hidden */
    }
</style>
<script type="text/javascript" src="/Content/assets/vendor/jquery/jquery.js"></script>
@if (Model != null)
{
    @Html.AntiForgeryToken()
    <div class="form-horizontal">
        <section class="panel  @(ViewBag.OpenPanel != null ? "" : "panel-featured panel-featured-info")">

            <header class="panel-heading">
                <h2 class="panel-title">@GlobalRes.ExchangeCurrencyExchangePage_Title</h2>
                @if (!(Model != null && Model.FxDealQuoteResult != null && Model.FxDealQuoteResult.Quote != null && Model.FxDealQuoteBookResult != null))
                {
                    <p class="panel-subtitle">
                        @Html.Raw(GlobalRes.ExchangeCurrencyExchangePage_SubTitle)
                    </p>
                }
            </header>


        <div class = "panel-body" >

            @Html.ValidationSummary(true, "", new {@class = "text-danger"})
            <div id = "step1" >
                @{ Html.RenderPartial("DropDownCurrency", Model);}
                <div class = "form-group" >
                    <label class = "col-sm-3 control-label labelAmount" >@GlobalRes.ExchangeCurrencyExchangePage_Amount</label>
                    <div class = "col-sm-2 currenySelector" >
                        @Html.DropDownListFor(d => d.SellCurrency, new List<SelectListItem>() {new SelectListItem() {Text = "---", Value = null}}, new {@class = "form-control", id = "dinamicDropDown"})
                    </div>
                    <div class = "col-sm-3 currenyAmount" >
                        @Html.TextBoxFor(m => m.BuyAmount, new {@class = "form-control", required = "", id = "buy", type = "number", step = "0.000001"})
                    </div>
                </div>
                @if (Model != null && Model.FxDealQuoteResult == null)
                {
                    <div class = "form-group" >
                        <div class = "col-md-6 col-md-offset-2 @(Model.IsError ? "alert alert-danger" : "alert alert-success") @(String.IsNullOrEmpty(Model.Message) ? "hidden" : "")" id = "viewInfo" >
                            @Html.Raw(Model.Message)
                        </div>
                    </div>
                    <script>
                        $(window).load(function() {
                            $("#viewInfo").hide();
                        });
                    </script>
                }
                else if (Model != null && Model.FxDealQuoteResult != null && Model.FxDealQuoteResult.Quote == null)
                {
                    <div class = "form-group" >
                        @if (Model.FxDealQuoteResult.ServiceResponse != null && Model.FxDealQuoteResult.ServiceResponse.HasErrors)
                        {
                            <div class = "col-md-6 col-md-offset-2 alert alert-danger" id = "viewInfo" >
                                @Model.FxDealQuoteResult.ServiceResponse.Responses[0].Message
                                <br/>
                                @Model.FxDealQuoteResult.ServiceResponse.Responses[0].MessageDetails
                            </div>
                            <script>
                                $(window).load(function() {
                                    $("#viewInfo").show();
                                });
                            </script>
                                @*<label class="col-sm-12 text-center" id="bookRes">
                                        <strong style="color: red">

                                        </strong>
                                    </label>*@
                        }
                        else
                        {
                            <script>
                                $(window).load(function() {
                                    $("#viewInfo").hide();
                                });
                            </script>
                        }
                        @*<div class = "col-md-12 @(Model.IsError ? "alert alert-danger" : "alert alert-success") @(String.IsNullOrEmpty(Model.Message) ? "hidden" : "")">
                                    @Html.Raw(Model.Message)
                                </div>*@
                    </div>
                }
                <footer class = "panel-footer" >
                    <div class = "row" >
                        <div class = "col-sm-9 col-sm-offset-3" >
                            <input type = "button" class = "btn btn-info col-sm-3" value = "@GlobalRes.ExchangeCurrencyExchangePage_Continue" id = "submitNewModelData" onclick = "submitNewModelDataClick()" style = "margin-right: 0.5em"/>
                            <a class = "btn btn-danger col-sm-3" href = "/" >@GlobalRes.ExchangeCurrencyExchangePage_Cancel</a>
                        </div>
                    </div>
                </footer>

            </div>
            @using (Html.BeginForm())
            {
                <div id = "step2" class = "hidden" >

                    @Html.HiddenFor(x => x.FromAccountId, new {id = "FromAccountId", onchange = "editddlcurrencies()"})
                    @Html.HiddenFor(x => x.ToAccountId, new {id = "ToAccountId", onchange = "editddlcurrencies()"})

                    @Html.HiddenFor(x => x.SellCurrency, new {id = "SellCurrency"})
                    @Html.HiddenFor(x => x.BuyAmount, new {id = "BuyAmount"})
                    @Html.HiddenFor(x => x.BuyAmount, new {id = "BuyAmountInput"})
                    @Html.HiddenFor(h => h.FxDealQuoteResult.Quote.QuoteId, new {id = "quoteId"})
                    @Html.HiddenFor(h => h.FxDealQuoteResult.Quote.BuyCurrencyCode, new {id = "buyCurrCode"})

                    @Html.HiddenFor(h => h.FxDealQuoteResult.Quote.SellAmount, new {id = "quoteSellAmount"})
                    @Html.HiddenFor(h => h.FxDealQuoteResult.Quote.SellCurrencyCode, new {id = "quoteSellCurrency"})
                    @Html.HiddenFor(h => h.FxDealQuoteResult.Quote.BuyAmount, new {id = "quoteBuyAmount"})
                    <div class = "form-group" >
                        <div class = "col-sm-12" >
                            <div class = "col-sm-4" >
                                <strong>@GlobalRes.FundingGetBankDepositsPage_Amount:</strong><br/>
                                <label>- <span id = "labelDealTypeSell" class = "text-left" ></span></label><br/>
                                <label>+ <span id = "labelDealTypeBuy" class = "text-left" ></span></label><br/>

                                <strong>@GlobalRes.ExchangeCurrencyExchangePage3_ExchangeRate</strong><br/>
                                <label id = "labelBuyRate" class = "text-left" ></label>
                            </div>
                        </div>

                    </div>
                    <div class = "form-group" >
                        <div class = "col-sm-12" >
                            <div class = "col-sm-10 col-sm-offset-1" >
                                <div class = "progress" >
                                    <div class = "progress-bar progress-bar-info" role = "progressbar" aria-valuenow = "0"
                                         aria-valuemin = "0" aria-valuemax = "1" style = "width: 100%" id = "dateTimer" >
                                    </div>
                                </div>
                            </div>
                        </div>
                        <label class = "col-sm-8 col-sm-offset-4" ><b><span id = "textDateTimer" >0</span></b>&nbsp;@GlobalRes.ExchangeCurrencyExchangePage_TimeRemining</label>
                    </div>
                    <footer class = "panel-footer" >
                        <div class = "row" >
                            <div class = "col-sm-9 col-sm-offset-3" >
                                <input type = "button" class = "btn btn-success col-sm-3" value = "@GlobalRes.ExchangeCurrencyExchangePage_TransferButton" id = "bookDealButton" oncliCK = "bookDealButtonClick()" style = "margin-right: 0.5em"/>
                                <a class = "btn btn-danger col-sm-3" onclick = "closebutton();" >@GlobalRes.ExchangeCurrencyExchangePage_Cancel</a>
                            </div>
                        </div>
                    </footer>
                </div>
            }
            <div id = "step3" class = "hidden" >
                <div class = "col-sm-12" >
                    @if (Model != null && Model.FxDealQuoteResult != null && Model.FxDealQuoteResult.Quote != null && Model.FxDealQuoteBookResult != null)
                    {

                        if (Model.FxDealQuoteBookResult.ServiceResponse != null && !Model.FxDealQuoteBookResult.ServiceResponse.HasErrors)
                        {
                            <label class = "col-sm-12 text-center" id = "bookRes" >
                                <strong>
                                    @String.Format("{0} {1} {2} {3}.", Model.FxDealQuoteResult.Quote.SellAmount, GlobalRes.ExchangeCurrencyExchangePage4_MessageFromAcc, Model.FxDealQuoteResult.Quote.SellCurrencyCode, GlobalRes.ExchangeCurrencyExchangePage4_MessageAcc2)
                                    <br/>
                                    @String.Format("{0} {1} {2} {3}.", Model.FxDealQuoteResult.Quote.BuyAmount, GlobalRes.ExchangeCurrencyExchangePage4_MessageToAcc, Model.FxDealQuoteResult.Quote.BuyCurrencyCode, GlobalRes.ExchangeCurrencyExchangePage4_MessageAcc)
                                </strong>
                            </label>
                        }
                        else if (Model.FxDealQuoteBookResult.ServiceResponse != null && Model.FxDealQuoteBookResult.ServiceResponse.HasErrors && Model.FxDealQuoteBookResult.ServiceResponse.Responses.Length > 0)
                        {
                            <label class = "col-sm-12 text-center" id = "bookRes" >
                                <strong style = "color: red" >
                                    @String.Format("{0}. {1}", GlobalRes.ExchangeCurrencyExchangePage4_MessageTransferFailed, Model.FxDealQuoteBookResult.ServiceResponse.Responses[0].Message)
                                </strong>
                            </label>
                        }
                        else if (Model.FxDealQuoteBookResult.ServiceResponse != null && Model.FxDealQuoteBookResult.ServiceResponse.HasErrors)
                        {
                            <label class = "col-sm-12 text-center" id = "bookRes" >
                                <strong style = "color: red" >
                                    @GlobalRes.ExchangeCurrencyExchangePage4_MessageUnspecError
                                </strong>
                            </label>
                        }
                    }
                </div>
                <footer class = "panel-footer" >
                    <div class = "row" >
                        <div class = "col-sm-12 text-center" >
                            <a class = "btn btn-success" href = "/" >@GlobalRes.ExchangeCurrencyExchangePage4_ReturnButton</a>
                        </div>
                    </div>
                </footer>

            </div>
        </div>
            @*@if ((Model != null && Model.FxDealQuoteResult == null) || (Model != null && Model.FxDealQuoteResult != null && Model.FxDealQuoteResult.Quote == null))
                {

                }

                @if (Model != null && Model.FxDealQuoteResult != null && Model.FxDealQuoteResult.Quote != null && Model.FxDealQuoteBookResult == null)
                {
                    using (Html.BeginForm())
                    {
                        @Html.AntiForgeryToken()
                        @Html.HiddenFor(x => x.FromAccountId, new { id = "FromAccountId", onchange = "editddlcurrencies()" })
                        @Html.HiddenFor(x => x.ToAccountId, new { id = "ToAccountId", onchange = "editddlcurrencies()" })
                        @Html.HiddenFor(x => x.SellCurrency, new { id = "SellCurrency" })
                        @Html.HiddenFor(x => x.BuyAmount, new { id = "BuyAmount" })
                        @Html.HiddenFor(h => h.FxDealQuoteResult.Quote.QuoteId, new { id = "quoteId" })
                        @Html.HiddenFor(h => h.FxDealQuoteResult.Quote.BuyCurrencyCode, new { id = "buyCurrCode" })

                        <div id="step1" class="hidden">
                            <div class="panel-body">

                                @{ Html.RenderPartial("DropDownCurrency", Model);}
                                <div class="form-group">
                                    <label class="col-sm-3 control-label labelAmount">@GlobalRes.ExchangeCurrencyExchangePage_Amount</label>
                                    <div class="col-sm-2 currenySelector">
                                        @Html.DropDownListFor(d => d.SellCurrency, Model.SelectedCurrency, new { @class = "form-control", id = "dinamicDropDown" })
                                    </div>
                                    <div class="col-sm-3 currenyAmount">
                                        @Html.TextBoxFor(m => m.BuyAmount, new { @class = "form-control", required = "", id = "buy", type = "number", step = "0.000001" })
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="col-md-12 @(Model.IsError ? "alert alert-danger" : "alert alert-success") @(String.IsNullOrEmpty(Model.Message) ? "hidden" : "")" id="viewInfo">
                                        @Html.Raw(Model.Message)
                                    </div>
                                </div>
                            </div>
                            <footer class="panel-footer">
                                <div class="row">
                                    <div class="col-sm-9 col-sm-offset-3">
                                        <input type="button" class="btn btn-info col-sm-3" value="@GlobalRes.ExchangeCurrencyExchangePage_Continue" id="submitNewModelData" onclick="submitNewModelDataClick()" style="margin-right:0.5em" />
                                        <a class="btn btn-danger col-sm-3" href="/">@GlobalRes.ExchangeCurrencyExchangePage_Cancel</a>
                                    </div>
                                </div>
                            </footer>
                        </div>


                    }

                }


                @if (Model != null && Model.FxDealQuoteResult != null && Model.FxDealQuoteResult.Quote != null && Model.FxDealQuoteBookResult != null)
                {

                }*@
        </section>
    </div>

}