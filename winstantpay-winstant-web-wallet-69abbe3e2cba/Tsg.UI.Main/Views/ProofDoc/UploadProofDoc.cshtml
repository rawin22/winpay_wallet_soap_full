@using System.Globalization
@using Tsg.UI.Main.App_LocalResources
@using Tsg.UI.Main.Models
@using TSG.Models.Enums
@model Tsg.UI.Main.Models.ProofDocModel

@{
    ViewBag.Title = GlobalRes.Shared_Navigation_AddFunds;
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}
<link href="/Content/viewer/viewer.css" rel="stylesheet">
<script src="/Content/viewer/viewer.js"></script>
@using (Html.BeginForm("UploadProofDoc", "ProofDoc", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <section class="panel  @(ViewBag.OpenPanel != null ? "" : "panel-featured panel-featured-info")">

            <header class="panel-heading" data-panel-toggle="">
                <div class="panel-actions">
                    <a href="#" class="panel-action panel-action-toggle" data-panel-toggle=""></a>
                </div>

                <h2 class="panel-title">@GlobalRes.ProofDocUploadProofDocPage_Title</h2>
                <p class="panel-subtitle">@GlobalRes.ProofDocUploadProofDocPage_SubTitle</p>
            </header>
            <div class="panel-body">
                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                @Html.HiddenFor(h => h.ProofDocId)
                <div class="form-group">
                    <label class="col-sm-3 control-label">@GlobalRes.ProofDocUploadProofDocPage_Status </label>
                    <div class="col-sm-6">
                        @Html.TextBox("status", Model.FundingStatus, new { @class = "form-control", required = "", disabled = "disabled" })
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-3 control-label">@GlobalRes.ProofDocUploadProofDocPage_ReceivingBank <span class="required" aria-required="true">*</span></label>
                    <div class="col-sm-6">
                        @if (Model.FundingEnumStatus == FundingStatus.Credited)
                        {
                            @Html.DropDownListFor(m => m.BankCurrencyId, Model.AvailableBankCurrencies, new { @class = "form-control", required = "", disabled = "disabled" })
                        }
                        else
                        {
                            @Html.DropDownListFor(m => m.BankCurrencyId, Model.AvailableBankCurrencies, new { @class = "form-control", required = "" })
                        }
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">@GlobalRes.ProofDocUploadProofDocPage_Amount <span class="required" aria-required="true">*</span></label>
                    <div class="col-sm-6">
                        <input class="form-control" id="Amount" name="Amount" required="" type="number" step="0.01" value="@(Model.Amount != 0 ? Model.Amount.ToString("G29") : "")" ,
                               onkeypress="return (event.charCode >= 48 && event.charCode <= 57) || event.charCode === 46 || event.charCode === 38 || event.charCode === 40 || event.charCode === 0",
                               @(Model.FundingEnumStatus == FundingStatus.Credited ? "disabled=\"disabled\"" : "") />
                        @*@Html.TextBoxFor(m => m.Amount, new { @class = "form-control", required = "" })*@
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-3 control-label">@GlobalRes.ProofDocUploadProofDocPage_PaymentDate <span class="required" aria-required="true">*</span></label>
                    <div class="col-sm-6">
                        <div class="input-group date" data-plugin-datepicker="" data-date-format="dd/mm/yyyy" id="dp3">
                            <span class="input-group-addon">
                                <i class="fa fa-calendar"></i>
                            </span>
                            @if (Model.FundingEnumStatus == FundingStatus.Credited)
                            {
                                @Html.TextBoxFor(t => t.PaymentDateString, Model.PaymentDate.ToString("dd/MM/yyyy", CultureInfo.CreateSpecificCulture("en-US")), new { @class = "form-control", onchange = "changeDateInPicker();", disabled = "disabled" })
                            }
                            else
                            {
                                @Html.TextBoxFor(t => t.PaymentDateString, Model.PaymentDate.ToString("dd/MM/yyyy", CultureInfo.CreateSpecificCulture("en-US")), new { @class = "form-control", onchange = "changeDateInPicker();", @readonly = "readonly" })
                            }
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">@GlobalRes.ProofDocUploadProofDocPage_NameOfSender <span class="required" aria-required="true">*</span></label>
                    <div class="col-sm-6">
                        @if (Model.FundingEnumStatus == FundingStatus.Credited)
                        {
                            @Html.TextBoxFor(m => m.CustomerName, new
                        {
                            @Value = !String.IsNullOrEmpty(Model.CustomerName) ? Model.CustomerName : (Tsg.UI.Main.Models.Security.AppSecurity.CurrentUser.FirstName + " " + Tsg.UI.Main.Models.Security.AppSecurity.CurrentUser.LastName),
                            @class = "form-control",
                            required = "",
                            disabled = "disabled"
                        })
                        }
                        else
                        {
                            @Html.TextBoxFor(m => m.CustomerName, new
                        {
                            @Value = !String.IsNullOrEmpty(Model.CustomerName) ? Model.CustomerName : (Tsg.UI.Main.Models.Security.AppSecurity.CurrentUser.FirstName + " " + Tsg.UI.Main.Models.Security.AppSecurity.CurrentUser.LastName),
                            @class = "form-control",
                            required = ""
                        })
                        }
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-3 control-label">@GlobalRes.ProofDocUploadProofDocPage_NameOfSendingBank <span class="required" aria-required="true">*</span></label>
                    <div class="col-sm-6">
                        @if (Model.FundingEnumStatus == FundingStatus.Credited)
                        {
                            @Html.TextBoxFor(m => m.BankName, new { @class = "form-control", required = "", disabled = "disabled" })
                        }
                        else
                        {
                            @Html.TextBoxFor(m => m.BankName, new { @class = "form-control", required = "" })
                        }
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-3 control-label">@GlobalRes.ProofDocUploadProofDocPage_AccountNumber <span class="required" aria-required="true">*</span></label>
                    <div class="col-sm-6">

                        @if (Model.FundingEnumStatus == FundingStatus.Credited)
                        {
                            @Html.TextBoxFor(m => m.LastFourDigits, new { @class = "form-control", required = "", disabled = "disabled" })
                        }
                        else
                        {
                            @Html.TextBoxFor(m => m.LastFourDigits, new { @class = "form-control", required = "" })
                        }
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-3 control-label">@GlobalRes.ProofDocUploadProofDocPage_OtherInformation </label>
                    <div class="col-sm-6">
                        @if (Model.FundingEnumStatus == FundingStatus.Credited)
                        {
                            @Html.TextBoxFor(m => m.OtherInfo, new { @class = "form-control", disabled = "disabled" })
                        }
                        else
                        {
                            @Html.TextBoxFor(m => m.OtherInfo, new { @class = "form-control" })
                        }
                    </div>
                </div>

                @if (!String.IsNullOrEmpty(Model.ProofDocPath) && File.Exists(Server.MapPath("~/Uploads/" + Model.ProofDocName)))
                {
                    <div class="form-group">
                        <label class="col-sm-3 control-label">@GlobalRes.ProofDocUploadProofDocPage_AttachmentFile</label>
                        <div class="col-sm-8">
                            <div>
                                <img id="image" src="~/Uploads/@Model.ProofDocName" class="img-rounded" style="max-width: 200px; max-height: 200px; " />
                            </div>
                            <script>
                                var viewer = new Viewer(document.getElementById('image'), { toolbar: 0, navbar: 0, rotatable: 0, fullscreen: 0, title: 0 });
                            </script>
                        </div>
                    </div>
                }
                @if (Model.FundingEnumStatus != FundingStatus.Credited)
                {
                    <div class="form-group">
                        <label class="col-sm-3 control-label">@GlobalRes.ProofDocUploadProofDocPage_AttachProof</label>
                        <div class="col-sm-8" id="file_load">
                            <div class="btn btn-primary" onclick="document.getElementById('PostedFile').click()">@GlobalRes.ProofDocUploadProofDocPage_AttachmentFile</div>
                            <label> @GlobalRes.CommonObject_NoFile </label>
                            <input type="file" name="PostedFile" id="PostedFile" accept="image/*" class="hidden" @*style="display: none"*@ />
                            @Html.HiddenFor(h => h.ProofDocPath, Model.ProofDocPath)
                            @Html.HiddenFor(h => h.ProofDocName, Model.ProofDocName)
                        </div>
                    </div>
                }
                <div class="form-group">
                    <div class="col-md-offset-3 col-md-10" style="color:green">
                        @ViewBag.Message
                    </div>
                </div>

            </div>

            <footer class="panel-footer">
                <div class="row">
                    <div class="col-sm-9 col-sm-offset-3">
                        @if (Model.FundingEnumStatus != FundingStatus.Credited)
                        {
                            <input type="submit" class="btn btn-success" value="@GlobalRes.ProofDocUploadProofDocPage_Save" />
                        }
                        <a class="btn btn-success" href="/Funding/GetBankDeposits">@GlobalRes.ProofDocUploadProofDocPage_DepositHistory</a>
                    </div>
                </div>
            </footer>

        </section>
    </div>
}

@section Scripts {
    @*@Scripts.Render("~/bundles/jqueryval")*@

    <script type="text/javascript">
        $(document).ready(function () {

            $.fn.datepicker.defaults.format = "dd/mm/yyyy";
            $("#dp3").datepicker();

        });

        $("#PostedFile").on("change",
            function () {
                var fileApi = (window.File && window.FileReader && window.FileList && window.Blob) ? true : false;

                var wrapper = $("#file_load"),
                    inp = wrapper.find("input"),
                    btn = wrapper.find("button"),
                    lbl = wrapper.find("label");

                var fileName;
                if (fileApi && inp[0].files[0])
                    fileName = inp[0].files[0].name;
                else
                    fileName = inp.val().replace("C:\\fakepath\\", '');

                if (!fileName.length)
                    return;
                if (lbl.is(":visible")) {
                    lbl.text(fileName);
                } 
            }).change();

        function changeDateInPicker() {
            $.fn.datepicker.defaults.format = "dd/mm/yyyy";

            //$("#datedaily").val($("#dp3").data('datepicker').getFormattedDate('dd/mm/yyyy'));
            $("#PaymentDate").val($("#dp3").data('datepicker').getFormattedDate('dd/mm/yyyy'));
            //console.log($("#datedaily").val());
            console.log($("#PaymentDate").val());
        }
    </script>
}