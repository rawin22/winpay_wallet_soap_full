@using Tsg.UI.Main.App_LocalResources
@model Tsg.UI.Main.Models.BankDepositModel

@{
    ViewBag.Title = GlobalRes.Shared_Navigation_AddFunds;
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}
<script src="/Content/assets/vendor/jquery/jquery.js"></script>
<script src="~/Content/ckeditor/ckeditor.js"></script>
@using (Html.BeginForm()) 
{
    @Html.AntiForgeryToken()

    <script type="text/javascript" src="/Content/assets/vendor/jquery/jquery.js"></script>

    <div class="form-horizontal">
        <section class="panel  @(ViewBag.OpenPanel != null ? "" : "panel-featured panel-featured-info")">

            <header class="panel-heading">
                <h2 class="panel-title">@GlobalRes.Shared_Navigation_DepositInstructions</h2>
                <p class="panel-subtitle">@GlobalRes.FundingAddBankDepositPage_SubTitle</p>
            </header>
            <input type="hidden" name="username" value="@Tsg.UI.Main.Models.Security.AppSecurity.CurrentUser.UserName" />
            <div class="panel-body">
                <div class="form-group">
                    <label class="col-sm-3 control-label">@GlobalRes.FundingAddBankDepositPage_CCY</label>
                    <div class="col-sm-6">
                        @Html.DropDownListFor(m => m.BankCurrencyId, Model.AvailableBankCurrencies, new { @class = "form-control"})
                    </div>
                </div>
                

                <div class="form-group">
                    @if (Request.Browser.IsMobileDevice)
                    {
                        <div class="col-sm-3">
                            <label class="controls-label">@GlobalRes.FundingAddBankDepositPage_WireInstructions</label><br />
                            <div class="col-sm-12" style="padding-right: 0px; padding-left: 0px">
                                <a href="#" class="text-left" id="printlink">
                                    @GlobalRes.FundingAddBankDepositPage_Print
                                    <i class="fa fa-print" style="font-size: 18px; padding-left: 0px !important;" aria-hidden="true"></i><br />
                                </a>

                            </div>
                            <div class="col-sm-12" style="padding-right: 0px; padding-left: 0px">
                                <a href="#" class="text-left" id="copylink">
                                    @GlobalRes.FundingAddBankDepositPage_Copy
                                    <i class="fa fa-copy" style="font-size: 18px; padding-left: 0px !important;" aria-hidden="true"></i><br />

                                </a>

                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="col-sm-3 text-right">
                            <label class="control-label">@GlobalRes.FundingAddBankDepositPage_WireInstructions</label><br/>
                            <div class="col-sm-12" style="padding-right: 0px">
                                <a href="#" class="col-sm-12" id="printlink" style="padding-right: 0px !important;">
                                    @GlobalRes.FundingAddBankDepositPage_Print
                                    <i class="fa fa-print" style="font-size: 18px; padding-left: 0px !important;" aria-hidden="true"></i><br/>
                                </a>

                            </div>
                            <div class="col-sm-12" style="padding-right: 0px">
                                <a href="#" class="col-sm-12" id="copylink" style="padding-right: 0px !important;">
                                    @GlobalRes.FundingAddBankDepositPage_Copy
                                    <i class="fa fa-copy" style="font-size: 18px; padding-left: 0px !important;" aria-hidden="true"></i><br/>

                                </a>

                            </div>
                        </div>
                    }
                    @*<label class="col-sm-3 control-label">Wire Instructions<br /></label>
                        
                            <a href="#" class="col-sm-9" id="printlink">Print</a>&nbsp;&nbsp;
                            <i class="fa fa-print" style="font-size: 18px;" aria-hidden="true"></i><br/>
                        
                        <br/>

                        <a href="#" class="col-sm-3" id="copylink">Copy</a>&nbsp;&nbsp;
                        <i class="fa fa-copy" style="font-size: 18px;" aria-hidden="true"></i>*@

                    <div class="col-sm-6">
                        @Html.TextAreaFor(m => m.WireInstruction, 5, 1, new {@class = "form-control", @readonly = "readonly", id = "nonHid"})
                        @Html.TextAreaFor(m => m.WireInstruction, 5, 1, new {@class = "form-control", @readonly = "readonly", id = "textEditorMessage", name = "textEditorMessage"})
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-md-offset-3 col-md-10" style="color:green">
                        @ViewBag.Message
                    </div>
                </div>

            </div>

            <footer class="panel-footer">
                <div class="row">
                    <div class="col-sm-9 col-sm-offset-3">
                        <input type="submit" class="btn btn-success" value="@GlobalRes.FundingAddBankDepositPage_UploadProof" />
                        <a class="btn btn-success" href="/Funding/GetBankDeposits">@GlobalRes.FundingAddBankDepositPage_DepositHistory</a>
                    </div>
                </div>
            </footer>

        </section>
    </div>
    
   <script type="text/javascript">
        CKEDITOR.replace('textEditorMessage',
            {
                removePlugins: 'sourcearea',
                removeButtons: 'About'
            });
        document.getElementById("copylink").addEventListener("click", function () { copyToClipboard(document.getElementById("nonHid")); });
        
       function copyToClipboard(elem) {
            var targetId = "_hiddenCopyText_";
            var isInput = elem.tagName === "INPUT" || elem.tagName === "TEXTAREA";
            var origSelectionStart, origSelectionEnd;
            if (isInput) {
                target = elem;
                origSelectionStart = elem.selectionStart;
                origSelectionEnd = elem.selectionEnd;
            } else {
                console.log('else');
                target = document.getElementById(targetId);
                if (!target) {
                    var target = document.createElement("textarea");
                    target.style.position = "absolute";
                    target.style.left = "-9999px";
                    target.style.top = "0";
                    target.id = targetId;
                    document.body.appendChild(target);
                }
                target.textContent = elem.textContent;
            }
            var currentFocus = document.activeElement;
            target.focus();
            target.setSelectionRange(0, target.value.length);
            var succeed;
            try {
                succeed = document.execCommand("copy");
            } catch (e) {
                succeed = false;
            }
            if (currentFocus && typeof currentFocus.focus === "function") {
                currentFocus.focus();
            }

            if (isInput) {
                elem.setSelectionRange(origSelectionStart, origSelectionEnd);
            } else {
                target.textContent = "";
            }
            return succeed;
        }
        $(function(){

            $("#BankCurrencyId").change(function () {

                var t = $(this).val();

                if (t !== "") {
                    $.post("@Url.Action("GetWireInstruction", "WireInstruction")?val=" + t,
                        function(res) {
                            if (res.Success === "true") {
                                try {
                                    var str = res.Data.WireInstruction;
                                    str = str.replace(/<\s*br\/*>/gi, "\n");
                                    str = str.replace(/<\s*a.*href="(.*?)".*>(.*?)<\/a>/gi, " $2 (Link->$1) ");
                                    str = str.replace(/<\s*\/*.+?>/ig, "\n");
                                    str = str.replace(/ {2,}/gi, " ");
                                    str = str.replace(/\n+\s*/gi, "\n\n");

                                    $("#nonHid").val(str);
                                    $("#WireInstruction").val(res.Data.WireInstruction);
                                    $("#textEditorMessage").val(res.Data.WireInstruction);
                                    CKEDITOR.instances.textEditorMessage.setData(res.Data.WireInstruction);
                                }
                                catch(ex)
                                {
                                    $("#nonHid").val($(res.Data.WireInstruction));
                                }
                            } else {
                                alert("Error getting data!");
                            }
                        });
                } else {
                    $("#nonHid").val("");
                    CKEDITOR.instances.textEditorMessage.setData("");
                }
            });
        });

        $("#printlink").click(function () {
            var t = $("#BankCurrencyId").val();
            var myWindow = window.open("", "_blank",           
                "menubar=no, toolbar=no, resizable=no, top=100, left=200, width=500, height=500");
            myWindow.document.write("<pre>" + $("#nonHid").val() + "</pre><br/><input type='button' value='Print' onclick='window.print();'>&nbsp;<input type='button' value='Close' onclick='window.close();'>");
        }); 
        $(document).ready(function () {
            $('#nonHid').css({ top: -9999, left: -9999, position: 'absolute' });
            $('#nonHid').removeAttr("display");
            $('#nonHid').removeAttr("visibility");
        });

        $(window).on("load", function () {
            setTimeout(function() {
                $('#cke_1_top').remove();
            },500);

        });
    </script>

}

@section Scripts {
    @*@Scripts.Render("~/bundles/jqueryval")*@
}
