@using Tsg.UI.Main.App_LocalResources
@model Tsg.UI.Main.Models.UserLoginModel

@{
    ViewBag.Title = GlobalRes.User_ChangePasswordPage_Title;
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}
<!-- Scripts -->
@*<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.2.min.js"></script>*@
@*<link href="http://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">*@

<script src="/Content/assets/vendor/jquery/jquery.js"></script>
@*<script src="/Content/assets/vendor/jquery-ui/jquery-ui.min.js"></script>*@
@*<script src="/Content/password_strength/password_strength.js" type="text/javascript"></script>*@
<script src="/Content/password_strength/password_strength_lightweight.js"></script>

<link rel="stylesheet" type="text/css" href="~/Content/password_strength/password_strength.css"/>

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
@*        <section class="panel  @(ViewBag.OpenPanel != null ? "" : "panel-featured panel-featured-info")">*@
        <section class="panel panel-default">

            <header class="panel-heading" @*data-panel-toggle=""*@>
                @*<div class="panel-actions">
                    <a href="#" class="panel-action panel-action-toggle" data-panel-toggle=""></a>
                </div>*@
                @Html.Hidden("RedirectTo", Url.Action("LogOut", "User"))
                <h2 class="panel-title">@GlobalRes.User_ChangePasswordPage_Title</h2>
                <p class="panel-subtitle">@Html.Raw(String.Format(GlobalRes.User_ChangePasswordPage_SubTitle, Html.ActionLink(GlobalRes.User_ChangePasswordPage_LogOut, "LogOut", "User", new { id = "logOutLink"})))</p>
            </header>

            <input type="hidden" name="username" value="@Tsg.UI.Main.Models.Security.AppSecurity.CurrentUser.UserName" />

            <div class="panel-body">
                @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                <div class="form-group">
                    <label class="col-sm-3 control-label">@GlobalRes.User_ChangePasswordPage_CurrentPassword <span class="required" aria-required="true">*</span></label>
                    <div class="col-sm-6">
                        @Html.PasswordFor(m => m.OldPassword, new { @class = "form-control", required = "", autocomplete = "off" })
                    </div>
                </div>
                @*<div id="newPassDiv"></div>*@

                <div class="form-group" >
                    <label class="col-sm-3 control-label">@GlobalRes.User_ChangePasswordPage_NewPassword <span class="required" aria-required="true">*</span></label>
                    <div class="col-sm-6">
                        @Html.PasswordFor(m => m.Password, new { @class = "form-control", required = "", autocomplete = "off" })
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="col-sm-3 control-label">@GlobalRes.User_ChangePasswordPage_RepeatNewPassword <span class="required" aria-required="true">*</span></label>
                    <div class="col-sm-6">
                        @Html.PasswordFor(m => m.RepeatPassword, new { @class = "form-control", required = "", autocomplete="off"  })
                    </div>
                </div>


                <div class="form-group">
                    <div class="col-md-offset-3 col-md-10" id="viewInfo" style=@(ViewBag.IsError ? "color:red" :
                         "color:green")>
                        @Html.Raw(ViewBag.Message)
                    </div>
                </div>

            </div>
            <script type="text/javascript" language="javascript">
                function beforeSubmit() {
                    console.log("beforeSubmit");

                    $("form").submit(function(e) {
                        if ($("#Password").val() !== $("#RepeatPassword").val()) {
                            e.preventDefault();
                            var $divmessage = $("<div id='messageInfo' style='color:red'>@GlobalRes.User_UserController_ChangePassword_UnSuccess</div>");
                            if ($("#messageInfo").val() == null) {
                                $("#viewInfo").append($divmessage);
                            } else {
                                $("#messageInfo").toggle();
                            }
                        }
                    });
                }
            </script>
            <footer class="panel-footer">
                <div class="row">
                    <div class="col-sm-9 col-sm-offset-3">
                        <input type="submit" class="btn btn-success" value="@GlobalRes.User_ChangePasswordPage_ResetPasswordBtn" onclick="beforeSubmit();" />
                    </div>
                </div>
            </footer>

        </section>
    </div>
}
<script type="text/javascript" language="javascript">
    $(document).ready(function ($) {
        $('#Password').parent().strength_meter();
        $('#RepeatPassword').parent().strength_meter();
    });
</script>
