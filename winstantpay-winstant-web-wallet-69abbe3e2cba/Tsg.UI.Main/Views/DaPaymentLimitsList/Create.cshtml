@using System.Globalization
@using Tsg.UI.Main.App_LocalResources
@using TSG.Models.Enums
@using TSG.Models.ServiceModels.LimitPayment
@using WinstantPay.Common.Extension
@model TSG.Models.ServiceModels.LimitPayment.DaPayLimitsSo

@{
    ViewBag.Title = GlobalRes.DelegatedAuthority_Title;
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
    Model.DaPayLimits_DateOfExpireString = (Model.DaPayLimits_DateOfExpire ?? DateTime.Now).ToString("dd/MM/yyyy", CultureInfo.CreateSpecificCulture("en-US"));
}
<link rel="stylesheet" href="/Content/assets/vendor/select2/css/select2.css" />
<link rel="stylesheet" href="/Content/assets/vendor/select2-bootstrap-theme/select2-bootstrap.css" />
<script src="/Content/assets/vendor/select2/js/select2.js"></script>

<link href="/Content/assets/vendor/bootstrap-toggle/css/bootstrap-toggle.css" rel="stylesheet">
<script src="/Content/assets/vendor/bootstrap-toggle/js/bootstrap-toggle.js"></script>

<link rel="stylesheet" href="/Content/assets/vendor/bootstrap-timepicker/css/bootstrap-timepicker.css">
<script src="/Content/assets/vendor/bootstrap-timepicker/bootstrap-timepicker.js"></script>
<script src="/Scripts/jquery.unobtrusive-ajax.min.js" type="text/javascript"></script>

@*<link rel="stylesheet" href="/Content/assets/vendor/bootstrap/css/bootstrap.css">*@
<link rel="stylesheet" href="/Content/assets/vendor/bootstrap-datepicker/css/bootstrap-datepicker3.css">
<link rel="stylesheet" href="/Content/assets/vendor/bootstrap-multiselect/bootstrap-multiselect.css">
<link rel="stylesheet" href="/Content/assets/vendor/bootstrap-tagsinput/bootstrap-tagsinput.css">
<link rel="stylesheet" href="/Content/assets/vendor/bootstrap-colorpicker/css/bootstrap-colorpicker.css">
<link rel="stylesheet" href="/Content/assets/vendor/bootstrap-timepicker/css/bootstrap-timepicker.css">
<link rel="stylesheet" href="/Content/assets/vendor/bootstrap-markdown/css/bootstrap-markdown.min.css">

@*<script src="/Content/assets/vendor/bootstrap/js/bootstrap.js"></script>*@
<script src="/Content/assets/vendor/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
<script src="/Content/assets/vendor/jquery-ui/jquery-ui.js"></script>
<script src="/Content/assets/vendor/jqueryui-touch-punch/jqueryui-touch-punch.js"></script>
<script src="/Content/assets/vendor/bootstrap-multiselect/bootstrap-multiselect.js"></script>
<script src="/Content/assets/vendor/jquery-maskedinput/jquery.maskedinput.js"></script>
<script src="/Content/assets/vendor/bootstrap-tagsinput/bootstrap-tagsinput.js"></script>
<script src="/Content/assets/vendor/bootstrap-colorpicker/js/bootstrap-colorpicker.js"></script>
<script src="/Content/assets/vendor/bootstrap-timepicker/bootstrap-timepicker.js"></script>
<script src="/Content/assets/vendor/bootstrap-maxlength/bootstrap-maxlength.js"></script>
@*<script src="/Content/assets/vendor/bootstrap-confirmation/bootstrap-confirmation.js"></script>*@

<style>
    .toggle-on {
        color: #ffffff !important;
    }

    .row.disable div:not(:first-child) {
        opacity: 0.4;
    }

    .checkbox, .toggle-group {
        opacity: 1 !important;
    }

    .red {
        color: red;
    }
</style>

<script type="text/javascript">
    function DaCreateCompleted(data) {
        console.log(data);

        $('#LoadingOverlayApi').trigger('loading-overlay:hide');
        if (data.responseJSON && !data.responseJSON.Success) {
            if (data.responseJSON.InfoBlock) {
                $('#limitationBlock').append('<div class="alert alert-danger">' +
                    data.responseJSON.InfoBlock.UserMessage +
                    '</div>');
            } else {
                $('#limitationBlock').append('<div class="alert alert-danger">' +
                    '@GlobalRes.ShopingCardController_UnspecError' +
                    '</div>');
            }
            setTimeout(function()  { $('#limitationBlock').empty(); }, 3000);
        } else {
            if ($('#saveBlock')) {
                $('#saveBlock').remove();
            }
            if (data.responseJSON.DaPayLimits_ID !== "undefined" || data.responseJSON.DaPayLimits_ID !== '@Guid.Empty') {
                console.log(data.responseJSON);
                window.location.href = '@Url.Action("Edit", "DaPaymentLimitsList")' + '/' + data.responseJSON.DaPayLimits_ID;
            }
            $(".disable").find('input[type="number"]').prop("disabled", true);
            $(".disable").find('button').prop("disabled", true);
            $('input[type="checkbox"]').bootstrapToggle();
        }
    }
    function CheckForm() {
        if ($("#DaPayLimits_MediaName").val() === "") {
            $('#DaPayLimits_MediaName_ValidationMessage').removeClass("hidden");
            console.log("DaPayLimits_MediaName");

            return false;
        }
        //if (!$('#DaPayLimits_CcyCode :selected').val() || $('#DaPayLimits_CcyCode :selected').val() === "") {
        //    $('#DaPayLimits_CcyCode_validationMessage').removeClass("hidden");
        //    console.log("DaPayLimits_CcyCode");

        //    return false;
        //}
        if ($("#text_DaPayLimits_LimitCodeInitialization").val() === "" && $("#text_DaPayLimits_LimitCodeInitialization").val().match("^(?=.{6,20}$)[a-zA-Z0-9]+([a-zA-Z0-9]+)?$")==null) {
            console.log("text_DaPayLimits_LimitCodeInitialization");

            $('#DaPayLimits_LimitCodeInitialization_validationMessage').removeClass("hidden");
            return false;
        }

        //alert(parseFloat($("#DaPayLimits_RequiredPinAmount").val()))
        //alert(parseFloat($("#DaPayLimits_RequiredPinAmount").val()) > 0);
        //alert($("#DaPayLimits_PinCode").val().length < 4);
        //if (parseFloat($("#DaPayLimits_RequiredPinAmount").val()) > 0 && $("#DaPayLimits_PinCode").val().length <4) {
        //    $('#DaPayLimits_PinCode_Required_validationMessage').removeClass("hidden");
        //    console.log("DaPayLimits_RequiredPinAmount is greater than 0 and PIN is required");

        //    return false;
        //}

        $('#LoadingOverlayApi').trigger('loading-overlay:show');
        console.log("presubmit");
        return true;
    }
</script>

<div class="row">

    <section class="panel">
        <header class="panel-heading" data-panel-toggle="">
            <div class="panel-actions">
                <a href="#" class="panel-action panel-action-toggle" data-panel-toggle=""></a>
            </div>

            <h2 class="panel-title">@GlobalRes.DelegatedAuthority_Title</h2>
            <p class="panel-subtitle">@GlobalRes.DelegatedAuthority_SubTitle</p>
            
        </header>
        @{
            AjaxOptions options = new AjaxOptions();
            options.OnComplete = "DaCreateCompleted";
            options.OnBegin = "CheckForm";
        }
        @using (Ajax.BeginForm("Create", "DaPaymentLimitsList", options))
        {
    
            @*@Html.ValidationSummary(true, "", new { @class = "text-danger" })*@
            @Html.HiddenFor(h => h.DaPayLimits_SourceType)
            @*@Html.HiddenFor(h => h.DaPayLimits_IsRestrictedToSelectedCurrency)*@


            <div class="panel-body" style="display: block;">
                <div class="row">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">
                            @GlobalRes.DelegatedAuthority_SetMediaName <span class="required" aria-required="true">*</span>
                        </label>
                        <div class="col-sm-5">
                            @Html.TextBoxFor(m => m.DaPayLimits_MediaName, new { @class = "form-control" })
                            @Html.ValidationMessageFor(m => m.DaPayLimits_MediaName, GlobalRes.DelegatedAuthority_MediaNameValidationError, new { @id = "DaPayLimits_MediaName_ValidationMessage", @class = "hidden red" })
                        </div>
                    </div>

                    @*<div class="form-group">
            <label class="col-sm-3 control-label">
                @GlobalRes.DelegatedAuthority_SetCurrency (@Html.DisplayNameFor(l => l.DaPayLimits_CcyCode)) <span class="required" aria-required="true">*</span>
            </label>
            <div class="col-sm-5">
                @Html.DropDownListFor(m => m.DaPayLimits_CcyCode, UiHelper.GetAccountBalancesForDa().Select(s => new SelectListItem() { Text = s.Text, Value = s.Value }), new { @class = "form-control" })
                @Html.ValidationMessageFor(m => m.DaPayLimits_CcyCode, GlobalRes.DelegatedAuthority_CurrencyValidationError, new { @id = "DaPayLimits_CcyCode_validationMessage", @class = "hidden red" })
                <input id="@Model.DaPayLimits_IsRestrictedToSelectedCurrency" type="checkbox" data-toggle="toggle" data-on='@GlobalRes.HomeAccountsList_Show' data-off='@GlobalRes.HomeAccountsList_Hide' data-size="small">
                <span>Restricted to Selected Currency</span>
                <div class="col-sm-2 col-sm-offset-1">
                    <div class="checkbox" style="margin-top: 0px">
                        <div id="nullAccount_LimTransaction">
                            <input id="@Model.DaPayLimits_IsRestrictedToSelectedCurrency" type="checkbox" data-toggle="toggle" data-on='@GlobalRes.HomeAccountsList_Show' data-off='@GlobalRes.HomeAccountsList_Hide' data-size="small">
                            <span>Restricted to Selected Currency</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>*@

                    @*<div class="form-group">
            <label class="col-sm-3 control-label">
                @GlobalRes.DelegatedAuthority_SetCurrency (@Html.DisplayNameFor(l => l.DaPayLimits_CcyCode)) <span class="required" aria-required="true">*</span>
            </label>
            <div class="col-sm-5">
                @Html.DropDownListFor(m => m.DaPayLimits_CcyCode, UiHelper.GetAccountBalancesForDa().Select(s => new SelectListItem() { Text = s.Text, Value = s.Value }), new { @class = "form-control" })
                @Html.ValidationMessageFor(m => m.DaPayLimits_CcyCode, GlobalRes.DelegatedAuthority_CurrencyValidationError, new { @id = "DaPayLimits_CcyCode_validationMessage", @class = "hidden red" })
                <input id="@Model.DaPayLimits_IsRestrictedToSelectedCurrency" type="checkbox" data-toggle="toggle" data-on='@GlobalRes.HomeAccountsList_Show' data-off='@GlobalRes.HomeAccountsList_Hide' data-size="small">
                <span>Restricted to Selected Currency</span>
                <div class="col-sm-2 col-sm-offset-1">
                    <div class="checkbox" style="margin-top: 0px">
                        <div id="nullAccount_LimTransaction">
                            <input id="@Model.DaPayLimits_IsRestrictedToSelectedCurrency" type="checkbox" data-toggle="toggle" data-on='@GlobalRes.HomeAccountsList_Show' data-off='@GlobalRes.HomeAccountsList_Hide' data-size="small">
                            <span>Restricted to Selected Currency</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>*@


                    @*<div class="form-group">
            <label class="col-sm-3 control-label">
                Limit Amount <span class="required" aria-required="true">*</span>
            </label>
            <div class="col-sm-5">
                @Html.TextBoxFor(m => m.DaPayLimits_RequiredPinAmount, new { @class = "form-control" })
                @Html.ValidationMessageFor(m => m.DaPayLimits_RequiredPinAmount, GlobalRes.DelegatedAuthority_MediaNameValidationError, new { @id = "DaPayLimits_RequiredPinAmount_ValidationMessage", @class = "hidden red" })
            </div>
        </div>*@
                    <div class="form-group @(Model.AccountWPayIds.Count > 1? "":"hidden")">
                        <label class="col-sm-3 control-label">WPayId</label>
                        <div class="col-sm-5">
                            @Html.DropDownListFor(m => m.DaPayLimits_WPayId, Model.AccountWPayIds, new { @class = "form-control" })
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label"> @GlobalRes.DelegatedAuthority_ExpDate</label>

                        <div class="col-sm-4">
                            <span class="btn btn-default" id="btnAddDateTime"><i class="fa fa-plus-circle" style="color: green; padding-right: 0.5em"></i>@GlobalRes.DelegatedAuthority_AddExpDate</span>
                        </div>
                        <div class="col-sm-3 hidden" id="blockDateExpire">
                            <div class="input-group date" id="dp3">
                                <span class="input-group-addon">
                                    <i class="fa fa-calendar"></i>
                                </span>
                                @*@Html.TextBoxFor(t => t.DaPayLimits_DateOfExpireString, new { @class = "form-control", , @ })*@
                                <input type="text" data-plugin-datepicker="" name="DaPayLimits_DateOfExpireString" id="DaPayLimits_DateOfExpireString"
                                       data-date-format="dd/mm/yyyy" data-plugin-options="{ &quot;todayHighlight&quot;: true, &quot;startDate&quot;: &quot;@(DateTime.Now.ToString("dd/MM/yyyy"))&quot; }" @*value = "@(DateTime.Now.ToString("dd/MM/yyyy"))"*@ readonly="readonly" class="form-control">
                            </div>
                        </div>
                        <div class="col-sm-2 hidden" id="blockTimeExpire">
                            <div class="input-group">
                                <span class="input-group-addon">
                                    <i class="fa fa-clock-o"></i>
                                </span>
                                <input type="text" data-plugin-timepicker="" name="DaPayLimits_TimeOfExpireString" id="DaPayLimits_TimeOfExpireString" class="form-control" data-plugin-options='{ "showMeridian": false }'>

                            </div>
                        </div>
                    </div>

                    
                    @if (Model.DaPaymentLimitSourceType.DaPaymentLimitSourceType_SysName == "SecretPhrase")
                    {
                        <div class="form-group">
                            <label class="col-sm-3 control-label">
                                @(EnumHelper<DelegatedAuthorirySourceLimitationTypeEnum>.GetDisplayValue((DelegatedAuthorirySourceLimitationTypeEnum)Model.DaPaymentLimitSourceType.DaPaymentLimitSourceType_EnumNumber))
                            </label>
                            <div class="col-sm-5">
                                @Html.TextBoxFor(t => t.DaPayLimits_LimitCodeInitialization, new { id = "text_DaPayLimits_LimitCodeInitialization", @class = "form-control" })
                                @Html.ValidationMessageFor(m => m.DaPayLimits_LimitCodeInitialization, GlobalRes.DelegatedAuthority_SecretCodeRequirements, new { @id = "DaPayLimits_LimitCodeInitialization_validationMessage", @class = "hidden red" })
                            </div>
                        </div>
                    }
                </div>
                <br />
                <div class="row" id="limitationBlock">
                </div>

                <div class="row" style="display: flex; justify-content: center" id="saveBlock">
                    <button type="submit" class="btn btn-success col-sm-3 " id="saveDauth">@GlobalRes.User_ProfilePage_Save</button>
                </div>
            </div>
        }
    </section>
</div>

@section Scripts {
    @*@Scripts.Render("~/bundles/jqueryval")*@
}

<script type="text/javascript" language="javascript">
    $(document).ready(function () {
        //        $(".disable").find('input[type="number"]').prop("disabled", true);
        //        $(".disable").find('button').prop("disabled", true);
         $(".disable")
    });

    //$('#checkbox_LimTransaction').change(function () {
    //    console.log($(this));
    //    if ($(this).prop('checked')) {
    //        $('#checkbox_LimTransaction').prop('checked', true);
    //        $("#limTransaction").removeClass("disable");

    //        $("#limTransaction").find('input[type="number"]').prop("disabled", false);
    //        $("#limTransaction").find('button').prop("disabled", false);
    //    } else {
    //        $('#checkbox_LimTransaction').prop('checked', false);
    //        $("#limTransaction").addClass("disable");
    //        $("#limTransaction").find('input[type="number"]').prop("disabled", true);
    //        $("#limTransaction").find('button').prop("disabled", true);
    //    }
    //});



    $("#DaPayLimits_PinCode").keydown(function (e) {
        // Allow: backspace, delete, tab, escape, enter and .
        if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110]) !== -1 ||
            // Allow: Ctrl+A, Command+A
            (e.keyCode === 65 && (e.ctrlKey === true || e.metaKey === true)) ||
            // Allow: home, end, left, right, down, up
            (e.keyCode >= 35 && e.keyCode <= 40)) {
            // let it happen, don't do anything
            return;
        }
        // Ensure that it is a number and stop the keypress
        if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
            if ($("#DaPayLimits_PinCode_validationMessage").hasClass('hidden'))
                $("#DaPayLimits_PinCode_validationMessage").removeClass('hidden');
            e.preventDefault();
        } else {
            if (!($("#DaPayLimits_PinCode_validationMessage").hasClass('hidden')))
                $("#DaPayLimits_PinCode_validationMessage").addClass('hidden');
        }
    }).blur(function () {
        if (!($("#DaPayLimits_PinCode_validationMessage").hasClass('hidden'))) {
            setTimeout(function () { $("#DaPayLimits_PinCode_validationMessage").addClass('hidden'); }, 2000);
        }
    }).focusout(function () {
        if (!($("#DaPayLimits_PinCode_validationMessage").hasClass('hidden'))) {
            setTimeout(function () { $("#DaPayLimits_PinCode_validationMessage").addClass('hidden'); }, 2000);
        }
    });

    $('#text_DaPayLimits_LimitCodeInitialization').on('keydown change', function () {
        setTimeout(function () {
            if ($("#text_DaPayLimits_LimitCodeInitialization").val()) {
                $("#text_DaPayLimits_LimitCodeInitialization").val($("#text_DaPayLimits_LimitCodeInitialization").val().toLowerCase().replace(/[^a-z0-9]/g, ''));
            }
        }, 100);
    });
    $('#btnAddDateTime').click(function() {
        // set value to date and time
        $("#DaPayLimits_DateOfExpireString").val("@(DateTime.Now.ToString("dd/MM/yyyy"))");
        $("#DaPayLimits_TimeOfExpireString").val("@(DateTime.Now.ToString("HH:mm"))");
        $(this).parent().addClass("hidden");
        $("#blockDateExpire").removeClass("hidden");
        $("#blockTimeExpire").removeClass("hidden");

    });
    $('#DaPayLimits_MediaName').on('keyup', function () {
        $(this).val($(this).val().replace(/\s\s+/g, ' '));
    });

    $('#DaPayLimits_MediaName').on('change', function () {
        $(this).val($(this).val().trim());
    });

    //$('#DaPayLimits_CcyCode').change(function () {
    //    $('#DaPayLimits_CcyCode_validationMessage').addClass("hidden");
    //});

    $('#selectButton').click(function () {
        setTimeout(function () { $('#searchabletext').focus(); }, 100);
    });
    $('#ddlmenu li a').on('click',
        function () {
            console.log("Func work");
            var id = $(this).data('pdsa-dropdown-val');
            var id1 = "";

            if (id != null) {
                console.log(id);
                var buttons = document.getElementById("selectButton");

                try {
                    id1 = id.toLowerCase();
                } catch (e) {
                    id1 = id;
                }

                buttons.innerHTML = '<img src="/Content/assets/images/onebyone.png" class="flag flag-' + id1 + '"/>' + '  ' +
                    id +
                    '&nbsp;<span class="caret" style="position: absolute; top: 45%; left: 97.5%; color: #555555 !important; border-top: 6px dashed !important; border-right: 3px solid transparent !important;border-left: 3px solid transparent !important"></span>';
                $("#ddlmenu").val(id);
                console.log("#ddlmenu");
                $("#DaPayLimits_CcyCode").val(id);
                $("#searchabletext").val("");
                $("#ddlmenu li").show();
                console.log("#DaPayLimits_CcyCode");
                $('#selectButton').removeClass("error_btn");
                $("#notificatorCcy").empty();
            }
            else {
                var buttons = document.getElementById("selectButton");
                buttons.innerHTML = '@String.Format(GlobalRes.Shared_NewInstantPaymentFormPage_SelectCurrency)' + '&nbsp;<span class="caret" style="position: absolute; top: 45%; left: 97.5%; color: #555555 !important; border-top: 6px dashed !important; border-right: 3px solid transparent !important;border-left: 3px solid transparent !important"></span>';
                $("#ddlmenu").val(null);
                //console.log("#ddlmenu");
                $("#DaPayLimits_CcyCode").val(null);
                $("#searchabletext").val("");
                $("#ddlmenu li").show();
                console.log("#DaPayLimits_CcyCode");
            }
        });

    $("#searchabletext").on("input", function () {
        var selText = $(this).val();
        //console.log($(this).val());
        $("#ddlmenu li").hide();
        $("#searchabli").show();
        $("#ddlmenu li").each(function () {
            if ($(this).text().trim().indexOf(selText.toUpperCase()) >= 0) {
                $("#curr_" + $(this).text().trim()).show();
            }
        });
        $("#searchabletext").one("keydown", function (e) {
            if (e.which == 13 || e.which == 10) {
                if ($("#ddlmenu li:visible").first() !== null) {
                    var el = $("#ddlmenu li:visible a").attr('display', 'list-item').first();
                    var id = el.data('pdsa-dropdown-val');
                    if (id != null) {
                        console.log("Entered");

                        console.log(id);
                        var buttons = document.getElementById("selectButton");
                        buttons.innerHTML = '<img src="/Content/assets/images/onebyone.png" class="flag flag-' + id.toLowerCase() + '"/>' + '  ' +
                            id +
                            '&nbsp;<span class="caret" style="position: absolute; top: 45%; left: 97.5%; color: #555555 !important; border-top: 6px dashed !important; border-right: 3px solid transparent !important;border-left: 3px solid transparent !important"></span>';
                        $("ddlmenu").val(id);
                        console.log("#ddlmenu");
                        $("#DaPayLimits_CcyCode").val(id);
                        $("#searchabletext").val("");
                        $("#ddlmenu li").show();
                        $('#selectButton').removeClass("error_btn");
                        $("#notificatorCcy").empty();
                    }

                    else { console.log("Not Entered"); }
                }
            }
        });

    });

    function SetRestrictionToSelectedCurrency(inpChBx) {
        if ($(inpChBx).prop('checked')) {
            $(inpChBx).prop('checked', true);
            $("#DaPayLimits_IsRestrictedToSelectedCurrency").attr("value", "True");

        }
        else {
            $('#chkIsRestrictedToSelectedCurrency').prop('checked', false);
            $("#DaPayLimits_IsRestrictedToSelectedCurrency").attr("value", "False");

        }
    }
</script>